<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Molecule Mutation Tool â€“ Analyze Your Change</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- this is app.html -->
  <meta
    name="description"
    content="Describe a base molecule and a mutation. The AI explains how the change affects reactivity, mechanisms, acidity, and stability."
  />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <div class="logo">
        <span class="logo-icon">ðŸ§ª</span>
        <span class="logo-text">Molecule Mutation Generator</span>
      </div>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="index.html#how-it-works">How it works</a>
        <a href="index.html#features">Features</a>
        <a href="app.html" class="nav-cta">Try the tool</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="section-inner">
        <h1>Molecule Mutation Tool</h1>
        <p class="section-subtitle">
          Describe a molecule and the change you want to make. The AI will show how that mutation affects
          reactivity, acidity/basicity, sterics, electronics, and likely mechanisms.
        </p>

        <form id="mutation-form" class="example-block" style="margin-top: 1.5rem;">
          <label class="example-label">
            Base molecule
          </label>
          <textarea
            name="base_molecule"
            rows="3"
            class="inline-mono"
            placeholder="e.g., secondary alkyl bromide: CH3â€“CHBrâ€“CH2â€“CH3"
            required
          ></textarea>

          <label class="example-label" style="margin-top: 0.8rem;">
            Mutation
          </label>
          <textarea
            name="mutation"
            rows="3"
            class="inline-mono"
            placeholder="e.g., replace Br with OTs; add a nitro group para to the methyl."
            required
          ></textarea>

          <!-- ðŸ§ª Optional SMILES input for structure rendering -->
          <label class="example-label" style="margin-top: 0.8rem;">
            Optional SMILES (for structure drawing)
          </label>
          <input
            type="text"
            name="smiles"
            id="smiles-input"
            class="inline-mono"
            placeholder="e.g., CC(=O)Oc1ccccc1C(=O)O"
          />

          <label class="example-label" style="margin-top: 0.8rem;">
            Optional question / context
          </label>
          <textarea
            name="question"
            rows="2"
            class="inline-mono"
            placeholder="e.g., How does this affect SN1 vs SN2?"
          ></textarea>

          <div style="margin-top: 1rem; display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
            <button type="submit" class="btn btn-primary">Analyze mutation</button>
            <span id="loading-indicator" class="inline-mono" style="font-size: 0.8rem; display: none;">
              Analyzingâ€¦
            </span>
          </div>

          <div id="error" class="error" style="display: none; margin-top: 0.75rem;"></div>
        </form>

        <section id="results" class="section" style="display: none; margin-top: 2rem;">
          <div class="section-inner">
            <h2>Analysis Result</h2>
            <p id="summary"></p>

            <!-- ðŸ§ª Structure rendering block (SVG instead of canvas) -->
            <h3 style="margin-top: 1.3rem;">Structure (from SMILES)</h3>
            <div class="example-block" style="display: inline-block;">
              <svg
                id="smiles-svg"
                width="320"
                height="320"
                style="border: 1px solid #ddd; border-radius: 8px;"
              ></svg>
              <p
                id="smiles-error"
                class="error"
                style="display: none; margin-top: 0.5rem; font-size: 0.85rem;"
              ></p>
            </div>

            <h3 style="margin-top: 1.3rem;">Key changes</h3>
            <ul id="key-changes" class="example-block"></ul>

            <h3 style="margin-top: 1.3rem;">Mechanisms</h3>
            <div class="example-block">
              <p class="example-label">Before mutation</p>
              <p id="mech-before"></p>

              <p class="example-label">After mutation</p>
              <p id="mech-after"></p>

              <p class="example-label">Comparison</p>
              <p id="mech-comparison"></p>
            </div>

            <h3 style="margin-top: 1.3rem;">Example reactions</h3>
            <ul id="example-reactions" class="example-block"></ul>

            <h3 style="margin-top: 1.3rem;">Explanations</h3>
            <div class="example-block">
              <details open>
                <summary>Simple explanation</summary>
                <p id="explain-simple" style="margin-top: 0.5rem;"></p>
              </details>
              <details style="margin-top: 0.75rem;">
                <summary>Detailed explanation</summary>
                <p id="explain-detailed" style="margin-top: 0.5rem;"></p>
              </details>
            </div>
          </div>
        </section>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <p>ðŸ§ª Molecule Mutation Generator</p>
      <p class="footer-small">
        Experimental tool. Do not use as a substitute for real lab safety or professional chemical advice.
      </p>
    </div>
  </footer>

  <!-- SmilesDrawer library (use a stable 1.x that matches README examples) -->
  <script src="https://unpkg.com/smiles-drawer@1.0.10/dist/smiles-drawer.min.js"></script>

  <!-- Initialize SmilesDrawer SVG drawer and expose a helper for app.js -->
  <script>
    let svgDrawer = null;

    document.addEventListener("DOMContentLoaded", function () {
      const options = {
        width: 320,
        height: 320,
      };

      if (window.SmilesDrawer) {
        // Use the SVG drawer instead of the canvas drawer
        svgDrawer = new SmilesDrawer.SvgDrawer(options);
        console.log("SmilesDrawer SvgDrawer initialized:", svgDrawer);
      } else {
        console.error("SmilesDrawer failed to load.");
      }
    });

    // Global helper function that app.js can call
    // (name kept the same for compatibility)
    window.renderSmilesToCanvas = function (smiles) {
      if (!svgDrawer || !window.SmilesDrawer) return;

      const svgEl = document.getElementById("smiles-svg");
      const errEl = document.getElementById("smiles-error");

      if (!svgEl) return;

      // Clear previous error
      if (errEl) {
        errEl.style.display = "none";
        errEl.textContent = "";
      }

      // Clear previous SVG content
      while (svgEl.firstChild) {
        svgEl.removeChild(svgEl.firstChild);
      }

      const clean = (smiles || "").trim();
      if (!clean) {
        // nothing to draw
        return;
      }

      console.log("Trying to draw SMILES (SVG):", clean);

      SmilesDrawer.parse(
        clean,
        function (tree) {
          // Draw into the SVG element by its ID
          svgDrawer.draw(tree, "smiles-svg", "light", false);
        },
        function (err) {
          console.error("SmilesDrawer parse/draw error:", err);
          if (errEl) {
            errEl.textContent =
              "Could not parse SMILES. Please check the string.";
            errEl.style.display = "block";
          }
        }
      );
    };
  </script>

  <script src="app.js"></script>
</body>
</html>
